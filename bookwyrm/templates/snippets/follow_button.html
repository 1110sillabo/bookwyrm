{% load i18n %}
{% load interaction %}

{% if request.user == user or not request.user.is_authenticated %}
{# nothing to see here -- either it's yourself or your logged out #}
{% else %}

{% get_relationship user as relationship %}
{% if relationship.is_blocked %}
{% include 'snippets/block_button.html' with blocks=True %}
{% else %}

<div class="field{% if not minimal %} has-addons{% else %} mb-0{% endif %}">
    <div class="control">
        {% if not followers_page %}
        <form action="{% url 'follow' %}" method="POST" class="interaction follow_{{ user.id }} {% if relationship.is_following or relationship.is_follow_pending %}is-hidden{%endif %}" data-id="follow_{{ user.id }}">
            {% csrf_token %}
            <input type="hidden" name="user" value="{{ user.username }}">
            <button class="button is-small{% if not minimal %} is-link{% endif %}" type="submit">
                {% if show_username %}
                {% blocktrans with username=user.localname %}Follow @{{ username }}{% endblocktrans %}
                {% else %}
                {% trans "Follow" %}
                {% endif %}
            </button>
        </form>
        {% endif %}
        <form action="{% url 'unfollow' %}" method="POST" class="interaction follow_{{ user.id }}" data-id="follow_{{ user.id }}">
            {% csrf_token %}
            <input type="hidden" name="user" value="{{ user.username }}">
            {% if relationship.is_follow_pending %}
            <button class="button is-small is-danger is-light" type="submit">
                {% trans "Undo follow request" %}
            </button>
            {% elif followers_page %}
            <button class="button is-small is-danger is-light" type="submit" formaction="{% url 'remove-follow' %}">
                {% if show_username %}
                {% blocktrans with username=user.localname %}Remove @{{ username }}{% endblocktrans %}
                {% else %}
                {% trans "Remove" %}
                {% endif %}
            </button>
            {% else %}
            <button class="button is-small is-danger is-light" type="submit">
                {% if show_username %}
                {% blocktrans with username=user.localname %}Unfollow @{{ username }}{% endblocktrans %}
                {% else %}
                {% trans "Unfollow" %}
                {% endif %}
            </button>
            {% endif %}
        </form>
    </div>
    {% if not minimal %}
    <div class="control">
        {% include 'snippets/user_options.html' with user=user class="is-small" %}
    </div>
    {% endif %}
</div>

{% endif %}

{% endif %}
